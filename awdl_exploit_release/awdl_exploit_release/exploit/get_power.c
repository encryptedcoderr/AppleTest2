#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/ioctl.h>

#include <linux/wireless.h>

int get_generic_socket() {
    int fd = socket(AF_INET, SOCK_DGRAM, 0);
    if (fd < 0) {
        printf("unable to get AF_INET socket...\n");
    }
    return fd;
}

int main(int argc, char** argv) {
    if (argc < 2) {
        printf("usage: get_power interface_name\n");
        return 0; 
    }

    char* interface_name = argv[1];

    int fd = get_generic_socket();
    struct iwreq req = {0};

    strncpy(req.ifr_name, interface_name, IFNAMSIZ);

    req.u.txpower.value = -1;
    req.u.txpower.fixed = 1;
    req.u.txpower.flags = 0; // value is is dBm

    int err = ioctl(fd, SIOCGIWTXPOW, &req);
    printf("ioctl returned %d\n", err);
    printf("level: %d\n", req.u.txpower.value);

    return 0;
}
