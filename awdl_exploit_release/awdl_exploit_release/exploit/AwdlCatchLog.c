//gcc -o AwdlCatch AwdlCatchLog.c -lpcap
//gcc -o AwdlCatch AwdlCatchLog.c -L/usr/lib -lpcap
//gcc -o AwdlCatch AwdlCatchLog.c -I/path/to/awdl_structs.h -lpcap
//sudo ./AwdlCatchLog.c

#include <pcap/pcap.h>
#include <stdio.h>
#include "awdl_structs.h"

void log_awdl_info(unsigned char* user, const struct pcap_pkthdr *h, const unsigned char *bytes) {
    // Assume this function logs detailed info about AWDL frames
    FILE *logfile = fopen("awdl_info.log", "a");
    if (logfile == NULL) {
        perror("Unable to open log file");
        return;
    }

    fprintf(logfile, "AWDL Frame Received:\nTimestamp: %lld\n", h->ts.tv_sec);
    // Detailed parsing and logging of AWDL frame contents
    fclose(logfile);
}

int main() {
    char *interface = "wlan3";
    char errbuf[PCAP_ERRBUF_SIZE];
    pcap_t *handle = pcap_open_live(interface, BUFSIZ, 1, 1000, errbuf);
    if (handle == NULL) {
        fprintf(stderr, "Couldn't open device %s: %s\n", interface, errbuf);
        return 2;
    }

    pcap_loop(handle, 0, log_awdl_info, NULL);
    pcap_close(handle);
    return 0;
}
